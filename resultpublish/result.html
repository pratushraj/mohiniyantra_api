<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Results History | RajaRani Mohini</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;800&family=Questrial&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --pink-bg: #f3728f;
            --plate-bg: #FFEEB4;
            --plate-border: #5c4c34;
            --gold: #ffcc00;
        }

        body {
            margin: 0;
            padding: 0;
            background: var(--pink-bg);
            font-family: 'Questrial', sans-serif;
            color: #000;
            min-height: 100vh;
        }

        .header {
            background: transparent;
            padding: 10px 20px;
            display: flex;
            justify-content: flex-end;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .close-btn {
            background: linear-gradient(135deg, #ff4d4d 0%, #cc0000 100%);
            color: #fff;
            text-decoration: none;
            padding: 6px 25px;
            border-radius: 4px;
            font-weight: 800;
            font-family: 'Montserrat', sans-serif;
            font-size: 15px;
            text-transform: uppercase;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.2s;
        }

        .close-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 10px;
        }

        .date-display-top {
            text-align: center;
            font-family: 'Montserrat', sans-serif;
            font-weight: 800;
            font-size: 24px;
            color: #333;
            margin-bottom: 15px;
            letter-spacing: 1px;
        }

        .controls {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        input[type="date"] {
            background: var(--plate-bg);
            border: 2px solid var(--plate-border);
            padding: 8px 15px;
            border-radius: 8px;
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            font-size: 16px;
            outline: none;
            color: #000;
        }

        .results-table-container {
            border-radius: 10px;
            overflow-x: hidden;
            /* Prevent body overflow, keep table width management */
        }

        .results-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 6px;
            table-layout: fixed;
            /* Force fixed layout for better control */
        }

        .results-table th {
            background: var(--plate-bg);
            padding: 8px 4px;
            font-family: 'Montserrat', sans-serif;
            text-transform: uppercase;
            font-size: 16px;
            font-weight: 800;
            color: Red;
            text-align: center;
            border: 2px solid var(--plate-border);
        }

        .results-table th:first-child {
            border-radius: 8px 0 0 8px;
            border-right: none;
        }

        .results-table th:last-child {
            border-radius: 0 8px 8px 0;
        }

        .result-row td {
            background: var(--plate-bg);
            padding: 8px 2px;
            text-align: center;
            border-top: 1px solid var(--plate-border);
            border-bottom: 1px solid var(--plate-border);
            font-family: 'Montserrat', sans-serif;
            font-weight: 800;
            font-size: 18px;
            overflow: hidden;
        }

        .result-row td:first-child {
            border-left: 2px solid var(--plate-border);
            border-radius: 8px 0 0 8px;
            color: #000;
            font-size: 14px;
            width: 70px;
            /* Specific width for time */
        }

        .result-row td:last-child {
            border-right: 2px solid var(--plate-border);
            border-radius: 0 8px 8px 0;
        }

        /* 3D Drum Digit Styling within Yellow Theme */
        .digit-box {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(180deg, #111 0%, #333 25%, #333 75%, #111 100%);
            color: #fff;
            width: 22px;
            height: 28px;
            border-radius: 3px;
            margin: 0 1px;
            font-family: 'Montserrat', sans-serif;
            font-size: 16px;
            font-weight: 800;
            border: 1px solid #000;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.5);
            vertical-align: middle;
        }

        .code-display {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: nowrap;
        }

        .code-prefix {
            background: #000;
            color: #fff;
            padding: 0 5px;
            height: 28px;
            display: inline-flex;
            align-items: center;
            border-radius: 3px;
            margin-right: 2px;
            font-size: 11px;
            font-weight: 800;
            border: 1px solid #111;
        }

        #statusMsg {
            text-align: center;
            padding: 20px;
            font-size: 18px;
            color: #fff;
            font-weight: 800;
            font-family: 'Montserrat', sans-serif;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        @media (max-width: 600px) {
            .container {
                padding: 10px 5px;
            }

            .results-table th {
                font-size: 11px;
                padding: 6px 2px;
            }

            .result-row td {
                font-size: 14px;
                padding: 6px 1px;
            }

            .result-row td:first-child {
                width: 60px;
                font-size: 11px;
            }

            .digit-box {
                width: 14px;
                height: 22px;
                font-size: 13px;
                margin: 0;
            }

            .code-prefix {
                height: 22px;
                font-size: 9px;
                padding: 0 3px;
                margin-right: 1px;
            }

            #statusMsg {
                font-size: 14px;
            }

            input[type="date"] {
                width: 100%;
                box-sizing: border-box;
                font-size: 14px;
                padding: 6px;
            }
        }
    </style>
</head>

<body>
    <header class="header">
        <a href="index.html" class="close-btn">CLOSE</a>
    </header>

    <div class="container">
        <div class="controls">
            <div class="date-input-wrapper">
                <input type="date" id="resDate" onchange="loadResults()">
            </div>
        </div>

        <div class="results-table-container">
            <table class="results-table">
                <thead>
                    <tr>
                        <th width="25%">Gift Event Code</th>
                        <th colspan="4">MOHINI GROUP</th>
                    </tr>
                </thead>
                <tbody id="resultBody">
                    <!-- Data injected here -->
                </tbody>
            </table>
            <div id="statusMsg">Gathering Records...</div>
        </div>
    </div>

    <script src="config.js"></script>
    <script>
        let rollingInterval = null;

        window.onload = () => {
            const today = new Date();
            const dateStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
            document.getElementById('resDate').value = dateStr;
            loadResults();
        };

        function formatCodeHTML(winCode) {
            if (!winCode || winCode === '--') return '--';
            const match = winCode.match(/^([A-Za-z]+)(.*)$/);
            if (match) {
                const prefix = match[1];
                const digits = match[2].split('');
                const digitHTML = digits.map(d => `<span class="digit-box">${d}</span>`).join('');
                return `<div class="code-display"><span class="code-prefix">${prefix}</span>${digitHTML}</div>`;
            }
            return winCode;
        }

        function getShuffleHTML(prefix) {
            const d1 = Math.floor(Math.random() * 10);
            const d2 = Math.floor(Math.random() * 10);
            return `<div class="code-display"><span class="code-prefix">${prefix}</span><span class="digit-box">${d1}</span><span class="digit-box">${d2}</span></div>`;
        }

        async function loadResults() {
            const dateInput = document.getElementById('resDate').value;
            if (!dateInput) return;

            if (rollingInterval) clearInterval(rollingInterval);

            const [year, month, day] = dateInput.split('-');
            const formattedDate = `${day}-${month}-${year}`;

            const body = document.getElementById('resultBody');
            const status = document.getElementById('statusMsg');

            body.innerHTML = '';
            status.style.display = 'block';
            status.innerText = 'FETCHING RESULTS FROM ARCHIVES...';

            try {
                const response = await fetch(CONFIG.GIFT_EVENT_CODE_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ date: formattedDate })
                });
                const result = await response.json();

                if (result.status && result.data && result.data.length > 0) {
                    status.style.display = 'none';
                    const sorted = result.data.sort((a, b) => Object.keys(b)[0].localeCompare(Object.keys(a)[0]));

                    const rowsData = [];
                    sorted.forEach((item, index) => {
                        const timeKey = Object.keys(item)[0];
                        const codes = item[timeKey];

                        let [h, m] = timeKey.split(':');
                        const ampm = +h >= 12 ? 'PM' : 'AM';
                        h = +h % 12 || 12;
                        const displayTime = `${h}:${m} ${ampm}`;

                        const tr = document.createElement('tr');
                        tr.className = 'result-row';

                        const prefixes = codes.map(c => (c && c !== '--') ? c.match(/^([A-Za-z]+)/)?.[1] || "NG" : "NG");

                        body.appendChild(tr);
                        rowsData.push({ tr, displayTime, codes, prefixes });
                    });

                    // Start Rolling
                    rollingInterval = setInterval(() => {
                        rowsData.forEach(row => {
                            row.tr.innerHTML = `
                                <td>${row.displayTime}</td>
                                <td>${getShuffleHTML(row.prefixes[0])}</td>
                                <td>${getShuffleHTML(row.prefixes[1])}</td>
                                <td>${getShuffleHTML(row.prefixes[2])}</td>
                                <td>${getShuffleHTML(row.prefixes[3])}</td>
                            `;
                        });
                    }, 60);

                    // Final Reveal after 5s
                    setTimeout(() => {
                        clearInterval(rollingInterval);
                        rowsData.forEach(row => {
                            row.tr.innerHTML = `
                                <td>${row.displayTime}</td>
                                <td>${formatCodeHTML(row.codes[0])}</td>
                                <td>${formatCodeHTML(row.codes[1])}</td>
                                <td>${formatCodeHTML(row.codes[2])}</td>
                                <td>${formatCodeHTML(row.codes[3])}</td>
                            `;
                        });
                    }, 5000);

                } else {
                    status.innerText = 'NO RECORDS FOUND FOR THIS DATE.';
                }
            } catch (e) {
                status.innerText = 'SYSTEM ERROR: UNABLE TO ACCESS RECORDS.';
                console.error(e);
            }
        }
    </script>
</body>

</html>